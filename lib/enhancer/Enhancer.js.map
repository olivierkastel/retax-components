{"version":3,"sources":["src/enhancer/Enhancer.js","src/enhancer/Enhancer.ts"],"names":["React","_","__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__metadata","k","v","metadata","__param","paramIndex","decorator","Enhancer","Target","config","EnhancedApi","reduxFacade","configStore","configure","EnhancedActionsCreator","apis","actionsCreators","zipObject","keys","serviceId","Array","ComposedComponent","RetaxComponent","kernel","context","services","getAllServices","createElement","assign","props","displayName","module","hot","retaxLib","require","accept","retax","reload"],"mappings":"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","file":"Enhancer.js","sourcesContent":["var __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nvar __param = (this && this.__param) || function (paramIndex, decorator) {\n    return function (target, key) { decorator(target, key, paramIndex); }\n};\nimport * as React from 'react';\nimport hoistNonReactStatic from 'hoist-non-react-statics';\nimport * as _ from 'lodash';\nimport { inject, multiInject, injectable } from 'inversify';\nimport { RetaxConsumer, RETAX_CONFIG_STORE, REDUX_FACADE } from 'retax-core';\nlet Enhancer = class Enhancer {\n    extendApi(Target, config) {\n        let EnhancedApi = class EnhancedApi extends Target {\n            constructor(reduxFacade, configStore) {\n                super(reduxFacade, configStore);\n                this.configure(config);\n            }\n        };\n        EnhancedApi = __decorate([\n            injectable(),\n            __param(0, inject(REDUX_FACADE)),\n            __param(1, inject(RETAX_CONFIG_STORE)), \n            __metadata('design:paramtypes', [Object, Object])\n        ], EnhancedApi);\n        return EnhancedApi;\n    }\n    extendActionsCreator(Target, config) {\n        let EnhancedActionsCreator = class EnhancedActionsCreator extends Target {\n            constructor(apis, actionsCreators) {\n                super(apis, actionsCreators);\n                this.configure({\n                    actionsCreators: _.zipObject(config.actionsCreators.keys, actionsCreators),\n                    apis: _.zipObject(config.apis.keys, apis),\n                });\n            }\n        };\n        EnhancedActionsCreator = __decorate([\n            injectable(),\n            __param(0, multiInject(config.apis.serviceId)),\n            __param(1, multiInject(config.actionsCreators.serviceId)), \n            __metadata('design:paramtypes', [Array, Array])\n        ], EnhancedActionsCreator);\n        return EnhancedActionsCreator;\n    }\n    extendComponent(ComposedComponent, config) {\n        let RetaxComponent = class RetaxComponent extends RetaxConsumer {\n            render() {\n                const { kernel } = this.context;\n                const services = kernel.getAllServices(config.actionsCreators.serviceId);\n                return React.createElement(ComposedComponent, Object.assign(_.zipObject(config.actionsCreators.keys, services), this.props));\n            }\n        };\n        RetaxComponent.displayName = `WithServices(${ComposedComponent.displayName || 'Nameless'})`;\n        RetaxComponent = __decorate([\n            injectable(), \n            __metadata('design:paramtypes', [])\n        ], RetaxComponent);\n        // webpack HMR\n        if (module && module.hot) {\n            const retaxLib = require('retax');\n            module.hot.accept();\n            retaxLib.retax.reload();\n        }\n        return hoistNonReactStatic(RetaxComponent, ComposedComponent);\n    }\n};\nEnhancer = __decorate([\n    injectable(), \n    __metadata('design:paramtypes', [])\n], Enhancer);\nexport default Enhancer;\n","import * as React from 'react';\nimport hoistNonReactStatic from 'hoist-non-react-statics';\nimport * as _ from 'lodash';\nimport { inject, multiInject, injectable } from 'inversify';\n\nimport {\n  IEnhancer,\n  IApiEnhancmentConfig,\n  IActionsCreatorEnhancmentConfig,\n  IComponentEnhancmentConfig,\n} from './interfaces';\n\nimport {\n  IUserService, IUserServiceMap,\n  IApiServiceConstructor,\n  IActionsCreatorServiceConstructor,\n  RetaxConsumer,\n  IRetaxConfigStore, RETAX_CONFIG_STORE,\n  IReduxFacade, REDUX_FACADE,\n} from 'retax-core';\n\n@injectable()\nexport default class Enhancer implements IEnhancer {\n  public extendApi(\n    Target: IApiServiceConstructor,\n    config: IApiEnhancmentConfig\n  ): IApiServiceConstructor {\n\n    @injectable()\n    class EnhancedApi extends Target {\n      constructor(\n        @inject(REDUX_FACADE) reduxFacade: IReduxFacade,\n        @inject(RETAX_CONFIG_STORE) configStore: IRetaxConfigStore\n      ) {\n        super(reduxFacade, configStore);\n        this.configure(config);\n      }\n    }\n\n    return EnhancedApi;\n  }\n\n  public extendActionsCreator(\n    Target: IActionsCreatorServiceConstructor,\n    config: IActionsCreatorEnhancmentConfig\n  ): IActionsCreatorServiceConstructor {\n\n    @injectable()\n    class EnhancedActionsCreator extends Target {\n      constructor(\n        @multiInject(config.apis.serviceId) apis: IUserService[],\n        @multiInject(config.actionsCreators.serviceId) actionsCreators: IUserService[]\n      ) {\n        super(apis, actionsCreators);\n        this.configure({\n          actionsCreators: _.zipObject<IUserServiceMap>(config.actionsCreators.keys, actionsCreators),\n          apis: _.zipObject<IUserServiceMap>(config.apis.keys, apis),\n        });\n      }\n    }\n\n    return EnhancedActionsCreator;\n  }\n\n  public extendComponent(\n    ComposedComponent: React.ComponentClass<any>,\n    config: IComponentEnhancmentConfig\n  ): typeof RetaxConsumer {\n\n    @injectable()\n    class RetaxComponent extends RetaxConsumer<void, void> {\n      public static displayName: string = `WithServices(${ComposedComponent.displayName || 'Nameless'})`;\n\n      public render(): JSX.Element {\n        const { kernel } = this.context;\n\n        const services = kernel.getAllServices<IUserService[]>(config.actionsCreators.serviceId);\n\n        return React.createElement(\n          ComposedComponent,\n          Object.assign(\n            _.zipObject<IUserServiceMap>(config.actionsCreators.keys, services),\n            this.props\n          )\n        );\n      }\n    }\n\n    // webpack HMR\n    if ((<any>module) && (<any>module).hot) {\n      const retaxLib = require('retax');\n      (<any>module).hot.accept();\n      retaxLib.retax.reload();\n    }\n\n    return hoistNonReactStatic(RetaxComponent, ComposedComponent);\n  }\n}\n"]}